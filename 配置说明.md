# 配置说明

## 1. Vite 代理配置

在 `vite.config.ts` 中已配置代理，将前端 API 请求转发到 AnkTech 服务器：

```typescript
proxy: {
  '/aqueti-api': {
    target: 'http://192.168.12.233:8081',
    ws: false,
    changeOrigin: true,
    secure: false,
  },
}
```

### 说明
- **target**: AnkTech API 服务器地址
- **changeOrigin**: 改变请求源，避免跨域问题
- **secure**: 允许 HTTPS 请求（当前为 HTTP）

## 2. AnkTech SDK 登录配置

在 `src/pages/MonitoringPage.tsx` 中配置：

```typescript
const LOGIN_CONFIG = {
  server: '192.168.12.233',  // AnkTech 服务器地址（不含协议）
  userId: 'test1',           // 用户名
  password: '123',           // 密码
  debug: true,               // 调试模式
};
```

### Options 完整配置项

```typescript
interface Options {
  server?: string;              // 服务器地址（必需）
  userId: string;               // 用户ID
  password: string;             // 密码
  debug?: boolean;              // 调试模式
  connectTimeout?: number;      // 连接超时（默认10000ms）
  heartbeatInterval?: number;   // 心跳间隔（默认5000ms）
  heartbeatTimeout?: number;    // 心跳超时（默认10000ms）
  reconnectInterval?: number;   // 重连间隔（默认5000ms）
  wsPort?: number;              // WebSocket端口
  token?: string;               // JWT令牌
}
```

## 3. 网络配置检查清单

### 3.1 服务器地址
确认 AnkTech 服务器地址可访问：
```bash
ping 192.168.12.233
```

### 3.2 端口开放
确认以下端口可访问：
- **8081**: HTTP API 端口
- **8084**: WebSocket 端口（可能）

### 3.3 测试连接
```bash
# 测试 API 端口
curl http://192.168.12.233:8081/aqueti-api/健康检查路径

# 测试 WebSocket 端口
# 使用 wscat 或浏览器开发者工具
```

## 4. 常见连接问题

### 问题1: "正在连接..." 持续显示

**可能原因**：
- 服务器地址不正确
- 服务器未启动或不可达
- 网络防火墙阻止连接
- WebSocket 端口配置错误

**解决方法**：
1. 检查浏览器控制台错误信息
2. 查看 Network 标签的 WebSocket 连接状态
3. 确认服务器配置：
   ```typescript
   const LOGIN_CONFIG = {
     server: '你的服务器IP',  // 修改为实际IP
     userId: '你的用户名',
     password: '你的密码',
     debug: true,
   };
   ```

### 问题2: 登录失败

**可能原因**：
- 用户名或密码错误
- Token 已过期
- 服务器认证配置问题

**解决方法**：
1. 确认登录凭据正确
2. 查看浏览器控制台的 `[AnkTech]` 日志
3. 检查网络请求响应

### 问题3: WebSocket 连接失败

**可能原因**：
- WebSocket 端口配置错误
- 代理配置问题
- 服务器不支持 WebSocket

**解决方法**：
1. 在 `vite.config.ts` 中添加 WebSocket 代理：
   ```typescript
   proxy: {
     '/message': {
       target: 'ws://192.168.12.233:8084',
       ws: true,
       changeOrigin: true,
       secure: false,
     }
   }
   ```

2. 或者在 LOGIN_CONFIG 中指定端口：
   ```typescript
   const LOGIN_CONFIG = {
     server: '192.168.12.233',
     wsPort: 8084,  // 指定 WebSocket 端口
     userId: 'test1',
     password: '123',
     debug: true,
   };
   ```

## 5. 调试方法

### 5.1 启用调试日志
已在配置中设置 `debug: true`，查看控制台输出：
- `[AnkTech] SDK版本: xxx`
- `[AnkTech] 登录成功`
- `[AnkTech] 收到消息: CMD`

### 5.2 查看网络请求
1. 打开浏览器开发者工具
2. 切换到 **Network** 标签
3. 筛选 **WS**（WebSocket）和 **XHR**（API请求）
4. 查看请求状态和响应内容

### 5.3 检查 WebSocket 连接
在 Network 标签中找到 WebSocket 连接：
- 绿色表示已连接
- 红色表示连接失败
- 点击查看消息帧（Frames）

## 6. 快速修改配置

### 修改服务器地址
编辑 `src/pages/MonitoringPage.tsx`:
```typescript
const LOGIN_CONFIG = {
  server: '你的IP地址',  // <-- 修改这里
  userId: 'test1',
  password: '123',
  debug: true,
};
```

### 修改代理地址
编辑 `vite.config.ts`:
```typescript
proxy: {
  '/aqueti-api': {
    target: 'http://你的IP:端口',  // <-- 修改这里
    ws: false,
    changeOrigin: true,
    secure: false,
  },
}
```

## 7. 重启开发服务器

每次修改配置后需要重启：

```bash
# 停止服务器（Ctrl+C）
# 然后重新启动
pnpm dev
```

## 8. 生产环境配置

生产环境建议：
1. 关闭 debug 模式
2. 使用环境变量管理配置
3. 启用 HTTPS
4. 配置适当的超时时间

```typescript
const LOGIN_CONFIG = {
  server: process.env.VITE_ANKTECH_SERVER,
  userId: process.env.VITE_ANKTECH_USER_ID,
  password: process.env.VITE_ANKTECH_PASSWORD,
  debug: false,  // 生产环境关闭
  connectTimeout: 15000,
  heartbeatInterval: 5000,
};
```

## 9. 联系支持

如遇到无法解决的问题：
1. 收集浏览器控制台完整日志
2. 收集 Network 标签的请求信息
3. 记录服务器配置信息
4. 联系技术支持团队

